/*
 * PlaneWave.cpp
 *
 *  Created on: Jun 28, 2013
 *      Author: luis
 */

#ifndef PLANEWAVE_H_
	#include "PlaneWave.h"
#endif

PlaneWave::PlaneWave() {

}

PlaneWave::PlaneWave(
 vector<unsigned int> elem,
 CVecD3 waveDirection,
 CVecD3 polarization,
 const Magnitude* magnitude) : EMSource(elem, magnitude) {
	bound_ = NULL;
	init(waveDirection, polarization);
}

PlaneWave::PlaneWave(
 BoxD3 bound,
 CVecD3 waveDirection,
 CVecD3 polarization,
 const Magnitude* magnitude) : EMSource(bound, magnitude) {
	init(waveDirection, polarization);
}

PlaneWave::~PlaneWave() {

}

void
PlaneWave::init(
 const CVecD3& waveDirection, const CVecD3& polarization) {
	waveDirection_ = waveDirection;
	polarization_ = polarization;
	if (polarization_.norm() == 0) {
		cout<< "ERROR @ PlaneWave: " << "Polarization can't be zero." << endl;
		printInfo();
	}
	if (waveDirection_.norm() == 0) {
		cout<< "ERROR @ PlaneWave: " << "W. Direction can't be zero." << endl;
		printInfo();
	}
	if (waveDirection_.norm() == 0.0 || polarization.norm() == 0.0) {
		cerr<< "ERROR @ Planewave: "
			<< "Wave direction and polarization cannot be zero" << endl;
		printInfo();
	}
	//
	if ((waveDirection ^ polarization).norm() !=
	 waveDirection.norm() * polarization.norm()) {
		cerr<< "ERROR @ Planewave: "
		    << "Wavedirection is not perpendicular to polarization." << endl;
	}
}

PlaneWave&
PlaneWave::operator=(const PlaneWave &rhs) {
	if (this == &rhs) {
		return *this;
	}
	EMSource::operator=(rhs);
	waveDirection_ = rhs.waveDirection_;
	polarization_ = rhs.polarization_;
	bound_ = rhs.bound_;
	return *this;
}

const BoxD3*
PlaneWave::getBound() const {
	return bound_;
}

void
PlaneWave::printInfo() const {
	cout<< " --- PlaneWave info --- " << endl;
	EMSource::printInfo();
	cout<< " - Polarization vector: ";
	polarization_.printInfo();
	cout<< endl;
	cout<< " - Wave direction vector: ";
	waveDirection_.printInfo();
	cout<< endl;
	if (bound_ != NULL) {
	    cout << "Defined on bound: " << endl;
		bound_->printInfo();
	}
}

CVecD3
PlaneWave::getElectricField(const double time) const {
	CVecD3 res = polarization_ * getMagnitude()->evaluate(time);
	return res;
}

pair<CVecD3, CVecD3>
PlaneWave::getElectromagneticField(const double time) const {
	CVecD3 electric = getElectricField(time);
	CVecD3 magnetic = (waveDirection_ ^ electric) * (double) VACUUM_ADMITANCE;
	return pair<CVecD3,CVecD3>(electric, magnetic);
}

const CVecD3&
PlaneWave::getPolarization() const {
	return polarization_;
}

const CVecD3&
PlaneWave::getWaveDirection() const {
	return waveDirection_;
}

void
PlaneWave::applyGeometricScalingFactor(const double factor) {
    if (bound_ != NULL) {
        bound_->scale(factor);
    }
}

